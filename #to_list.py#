import tweepy
import os, json


with open(os.path.join(os.getcwd(),"data/credentials_rw.json")) as data_file:    
    key = json.load(data_file)

with open(os.path.join(os.getcwd(),"data/names_plus.json")) as data_file:    
    records = json.load(data_file)

def get_list_members(api, owner, slug):
	members = []
	# need a cursor, otherwise just 20
	for page in tweepy.Cursor(api.list_members, owner, slug).items():
		members.append(page)
	return [ m.screen_name.encode('utf-8') for m in members ]

def twitter_setup():
    auth = tweepy.OAuthHandler(key["API_KEY"], key["API_SECRET"])
    auth.set_access_token(key["ACCESS_TOKEN"], key["ACCESS_TOKEN_SECRET"])    
    return tweepy.API(auth)

api = twitter_setup()
owner = 'cdvel'
list_slug = 'blockchain-crypto-women'

# Add people from a json file to existing list (might hit API throttler ~= 1000)
# https://twittercommunity.com/t/cant-add-members-to-a-list-code-104/25824/8

# print "rate limit %s"%(api.rate_limit_status()['resources']['lists'])

prev_list = get_list_members(api, owner, list_slug)
x_list = api.get_list(owner_screen_name=owner, slug=list_slug)


rate limit {u'rate_limit_context': {u'access_token': u'45582088-N3Lb3zeUgaA02Nyta5L1b6RnXjGiwUebVimM6D9xq'}, u'resources': {u'feedback': {u'/feedback/show/:id': {u'reset': 1517643937, u'limit': 180, u'remaining': 180}, u'/feedback/events': {u'reset': 1517643937, u'limit': 1000, u'remaining': 1000}}, u'moments': {u'/moments/statuses/update': {u'reset': 1517643937, u'limit': 5, u'remaining': 5}, u'/moments/permissions': {u'reset': 1517643937, u'limit': 300, u'remaining': 300}}, u'tweet_prompts': {u'/tweet_prompts/show': {u'reset': 1517643937, u'limit': 180, u'remaining': 180}, u'/tweet_prompts/report_interaction': {u'reset': 1517643937, u'limit': 180, u'remaining': 180}}, u'live_pipeline': {u'/live_pipeline/events': {u'reset': 1517643937, u'limit': 180, u'remaining': 180}}, u'friendships': {u'/friendships/outgoing': {u'reset': 1517643937, u'limit': 15, u'remaining': 15}, u'/friendships/no_retweets/ids': {u'reset': 1517643937, u'limit': 15, u'remaining': 15}, u'/friendships/list': {u'reset': 1517643937, u'limit': 200, u'remaining': 200}, u'/friendships/show': {u'reset': 1517643937, u'limit': 180, u'remaining': 180}, u'/friendships/incoming': {u'reset': 1517643937, u'limit': 15, u'remaining': 15}, u'/friendships/lookup': {u'reset': 1517643937, u'limit': 15, u'remaining': 15}}, u'statuses': {u'/statuses/retweets_of_me': {u'reset': 1517643937, u'limit': 75, u'remaining': 75}, u'/statuses/retweeters/ids': {u'reset': 1517643937, u'limit': 75, u'remaining': 75}, u'/statuses/mentions_timeline': {u'reset': 1517643937, u'limit': 75, u'remaining': 75}, u'/statuses/user_timeline': {u'reset': 1517643937, u'limit': 900, u'remaining': 900}, u'/statuses/lookup': {u'reset': 1517643937, u'limit': 900, u'remaining': 900}, u'/statuses/oembed': {u'reset': 1517643937, u'limit': 180, u'remaining': 180}, u'/statuses/show/:id': {u'reset': 1517643937, u'limit': 900, u'remaining': 900}, u'/statuses/friends': {u'reset': 1517643937, u'limit': 15, u'remaining': 15}, u'/statuses/home_timeline': {u'reset': 1517643937, u'limit': 15, u'remaining': 15}, u'/statuses/retweets/:id': {u'reset': 1517643937, u'limit': 75, u'remaining': 75}}, u'help': {u'/help/tos': {u'reset': 1517643937, u'limit': 15, u'remaining': 15}, u'/help/settings': {u'reset': 1517643937, u'limit': 15, u'remaining': 15}, u'/help/privacy': {u'reset': 1517643937, u'limit': 15, u'remaining': 15}, u'/help/configuration': {u'reset': 1517643937, u'limit': 15, u'remaining': 15}, u'/help/languages': {u'reset': 1517643937, u'limit': 15, u'remaining': 15}}, u'drafts': {u'/drafts/statuses/list': {u'reset': 1517643937, u'limit': 450, u'remaining': 450}, u'/drafts/statuses/destroy': {u'reset': 1517643937, u'limit': 450, u'remaining': 450}, u'/drafts/statuses/create': {u'reset': 1517643937, u'limit': 450, u'remaining': 450}, u'/drafts/statuses/ids': {u'reset': 1517643937, u'limit': 450, u'remaining': 450}, u'/drafts/statuses/update': {u'reset': 1517643937, u'limit': 450, u'remaining': 450}, u'/drafts/statuses/show': {u'reset': 1517643937, u'limit': 450, u'remaining': 450}}, u'contacts': {u'/contacts/uploaded_by': {u'reset': 1517643937, u'limit': 300, u'remaining': 300}, u'/contacts/users_and_uploaded_by': {u'reset': 1517643937, u'limit': 300, u'remaining': 300}, u'/contacts/delete/status': {u'reset': 1517643937, u'limit': 300, u'remaining': 300}, u'/contacts/users': {u'reset': 1517643937, u'limit': 300, u'remaining': 300}, u'/contacts/addressbook': {u'reset': 1517643937, u'limit': 300, u'remaining': 300}}, u'friends': {u'/friends/list': {u'reset': 1517643937, u'limit': 15, u'remaining': 15}, u'/friends/following/ids': {u'reset': 1517643937, u'limit': 15, u'remaining': 15}, u'/friends/ids': {u'reset': 1517643937, u'limit': 15, u'remaining': 15}, u'/friends/following/list': {u'reset': 1517643937, u'limit': 15, u'remaining': 15}}, u'business_experience': {u'/business_experience/dashboard_settings/show': {u'reset': 1517643937, u'limit': 450, u'remaining': 450}, u'/business_experience/keywords': {u'reset': 1517643937, u'limit': 450, u'remaining': 450}, u'/business_experience/dashboard_settings/destroy': {u'reset': 1517643937, u'limit': 450, u'remaining': 450}, u'/business_experience/dashboard_features': {u'reset': 1517643937, u'limit': 450, u'remaining': 450}, u'/business_experience/dashboard_settings/update': {u'reset': 1517643937, u'limit': 450, u'remaining': 450}}, u'application': {u'/application/rate_limit_status': {u'reset': 1517643926, u'limit': 180, u'remaining': 178}}, u'collections': {u'/collections/list': {u'reset': 1517643937, u'limit': 1000, u'remaining': 1000}, u'/collections/show': {u'reset': 1517643937, u'limit': 1000, u'remaining': 1000}, u'/collections/entries': {u'reset': 1517643937, u'limit': 1000, u'remaining': 1000}}, u'tweets': {u'/tweets/search/:product/:instance/counts': {u'reset': 1517643937, u'limit': 900, u'remaining': 900}, u'/tweets/search/:product/:label': {u'reset': 1517643937, u'limit': 1800, u'remaining': 1800}}, u'followers': {u'/followers/list': {u'reset': 1517643937, u'limit': 15, u'remaining': 15}, u'/followers/ids': {u'reset': 1517643937, u'limit': 15, u'remaining': 15}}, u'mutes': {u'/mutes/users/list': {u'reset': 1517643937, u'limit': 15, u'remaining': 15}, u'/mutes/users/ids': {u'reset': 1517643937, u'limit': 15, u'remaining': 15}}, u'saved_searches': {u'/saved_searches/show/:id': {u'reset': 1517643937, u'limit': 15, u'remaining': 15}, u'/saved_searches/list': {u'reset': 1517643937, u'limit': 15, u'remaining': 15}, u'/saved_searches/destroy/:id': {u'reset': 1517643937, u'limit': 15, u'remaining': 15}}, u'blocks': {u'/blocks/list': {u'reset': 1517643937, u'limit': 15, u'remaining': 15}, u'/blocks/ids': {u'reset': 1517643937, u'limit': 15, u'remaining': 15}}, u'users': {u'/users/suggestions/:slug': {u'reset': 1517643937, u'limit': 15, u'remaining': 15}, u'/users/lookup': {u'reset': 1517643937, u'limit': 900, u'remaining': 900}, u'/users/search': {u'reset': 1517643937, u'limit': 900, u'remaining': 900}, u'/users/suggestions/:slug/members': {u'reset': 1517643937, u'limit': 15, u'remaining': 15}, u'/users/contributors/pending': {u'reset': 1517643937, u'limit': 2000, u'remaining': 2000}, u'/users/show/:id': {u'reset': 1517643824, u'limit': 900, u'remaining': 898}, u'/users/suggestions': {u'reset': 1517643937, u'limit': 15, u'remaining': 15}, u'/users/contributees/pending': {u'reset': 1517643937, u'limit': 200, u'remaining': 200}, u'/users/report_spam': {u'reset': 1517643937, u'limit': 15, u'remaining': 15}, u'/users/profile_banner': {u'reset': 1517643937, u'limit': 180, u'remaining': 180}, u'/users/derived_info': {u'reset': 1517643937, u'limit': 15, u'remaining': 15}}, u'search': {u'/search/tweets': {u'reset': 1517643937, u'limit': 180, u'remaining': 180}}, u'lists': {u'/lists/subscribers/show': {u'reset': 1517643937, u'limit': 15, u'remaining': 15}, u'/lists/subscriptions': {u'reset': 1517643937, u'limit': 15, u'remaining': 15}, u'/lists/statuses': {u'reset': 1517643937, u'limit': 900, u'remaining': 900}, u'/lists/members/show': {u'reset': 1517643937, u'limit': 15, u'remaining': 15}, u'/lists/subscribers': {u'reset': 1517643937, u'limit': 180, u'remaining': 180}, u'/lists/list': {u'reset': 1517643937, u'limit': 15, u'remaining': 15}, u'/lists/show': {u'reset': 1517643823, u'limit': 75, u'remaining': 74}, u'/lists/memberships': {u'reset': 1517643937, u'limit': 75, u'remaining': 75}, u'/lists/members': {u'reset': 1517643821, u'limit': 900, u'remaining': 897}, u'/lists/ownerships': {u'reset': 1517643937, u'limit': 15, u'remaining': 15}}, u'custom_profiles': {u'/custom_profiles/list': {u'reset': 1517643937, u'limit': 180, u'remaining': 180}, u'/custom_profiles/show': {u'reset': 1517643937, u'limit': 180, u'remaining': 180}}, u'favorites': {u'/favorites/list': {u'reset': 1517643937, u'limit': 75, u'remaining': 75}}, u'device': {u'/device/token': {u'reset': 1517643937, u'limit': 15, u'remaining': 15}}, u'webhooks': {u'/webhooks/subscriptions/direct_messages': {u'reset': 1517643937, u'limit': 15, u'remaining': 15}, u'/webhooks': {u'reset': 1517643937, u'limit': 15, u'remaining': 15}}, u'geo': {u'/geo/similar_places': {u'reset': 1517643937, u'limit': 15, u'remaining': 15}, u'/geo/id/:place_id': {u'reset': 1517643937, u'limit': 75, u'remaining': 75}, u'/geo/reverse_geocode': {u'reset': 1517643937, u'limit': 15, u'remaining': 15}, u'/geo/search': {u'reset': 1517643937, u'limit': 15, u'remaining': 15}}, u'account': {u'/account/verify_credentials': {u'reset': 1517643937, u'limit': 75, u'remaining': 75}, u'/account/settings': {u'reset': 1517643937, u'limit': 15, u'remaining': 15}, u'/account/login_verification_enrollment': {u'reset': 1517643937, u'limit': 15, u'remaining': 15}, u'/account/update_profile': {u'reset': 1517643937, u'limit': 15, u'remaining': 15}}, u'live_video_stream': {u'/live_video_stream/status/:id': {u'reset': 1517643937, u'limit': 1000, u'remaining': 1000}}, u'i': {u'/i/config': {u'reset': 1517643937, u'limit': 15, u'remaining': 15}}, u'trends': {u'/trends/available': {u'reset': 1517643937, u'limit': 75, u'remaining': 75}, u'/trends/closest': {u'reset': 1517643937, u'limit': 75, u'remaining': 75}, u'/trends/place': {u'reset': 1517643937, u'limit': 75, u'remaining': 75}}, u'direct_messages': {u'/direct_messages/show': {u'reset': 1517643937, u'limit': 300, u'remaining': 300}, u'/direct_messages/mark_read': {u'reset': 1517643937, u'limit': 1000, u'remaining': 1000}, u'/direct_messages/broadcasts/show': {u'reset': 1517643937, u'limit': 60, u'remaining': 60}, u'/direct_messages/subscribers/lists/show': {u'reset': 1517643937, u'limit': 180, u'remaining': 180}, u'/direct_messages': {u'reset': 1517643937, u'limit': 300, u'remaining': 300}, u'/direct_messages/broadcasts/list': {u'reset': 1517643937, u'limit': 60, u'remaining': 60}, u'/direct_messages/sent_and_received': {u'reset': 1517643937, u'limit': 300, u'remaining': 300}, u'/direct_messages/subscribers/lists/members/ids': {u'reset': 1517643937, u'limit': 180, u'remaining': 180}, u'/direct_messages/subscribers/show': {u'reset': 1517643937, u'limit': 180, u'remaining': 180}, u'/direct_messages/subscribers/lists/list': {u'reset': 1517643937, u'limit': 180, u'remaining': 180}, u'/direct_messages/events/list': {u'reset': 1517643937, u'limit': 15, u'remaining': 15}, u'/direct_messages/broadcasts/statuses/list': {u'reset': 1517643937, u'limit': 60, u'remaining': 60}, u'/direct_messages/subscribers/ids': {u'reset': 1517643937, u'limit': 180, u'remaining': 180}, u'/direct_messages/subscribers/lists/members/show': {u'reset': 1517643937, u'limit': 1000, u'remaining': 1000}, u'/direct_messages/sent': {u'reset': 1517643937, u'limit': 300, u'remaining': 300}, u'/direct_messages/broadcasts/statuses/show': {u'reset': 1517643937, u'limit': 60, u'remaining': 60}, u'/direct_messages/events/show': {u'reset': 1517643937, u'limit': 15, u'remaining': 15}}, u'sandbox': {u'/sandbox/account_activity/webhooks/:id/subscriptions': {u'reset': 1517643937, u'limit': 500, u'remaining': 500}}, u'media': {u'/media/upload': {u'reset': 1517643937, u'limit': 500, u'remaining': 500}}, u'account_activity': {u'/account_activity/all/:instance_name/webhooks': {u'reset': 1517643937, u'limit': 15, u'remaining': 15}, u'/account_activity/webhooks/:id/subscriptions': {u'reset': 1517643937, u'limit': 500, u'remaining': 500}, u'/account_activity/direct_messages/:instance_name/subscriptions': {u'reset': 1517643937, u'limit': 15, u'remaining': 15}, u'/account_activity/all/:instance_name/subscriptions': {u'reset': 1517643937, u'limit': 15, u'remaining': 15}, u'/account_activity/webhooks/:id/subscriptions/all/list': {u'reset': 1517643937, u'limit': 15, u'remaining': 15}, u'/account_activity/direct_messages/webhooks': {u'reset': 1517643937, u'limit': 15, u'remaining': 15}, u'/account_activity/direct_messages/:instance_name/webhooks': {u'reset': 1517643937, u'limit': 15, u'remaining': 15}, u'/account_activity/webhooks/:id/subscriptions/direct_messages': {u'reset': 1517643937, u'limit': 500, u'remaining': 500}, u'/account_activity/webhooks/:id/subscriptions/all': {u'reset': 1517643937, u'limit': 500, u'remaining': 500}, u'/account_activity/webhooks': {u'reset': 1517643937, u'limit': 15, u'remaining': 15}, u'/account_activity/webhooks/:id/subscriptions/direct_messages/list': {u'reset': 1517643937, u'limit': 15, u'remaining': 15}, u'/account_activity/all/webhooks': {u'reset': 1517643937, u'limit': 15, u'remaining': 15}}, u'auth': {u'/auth/csrf_token': {u'reset': 1517643937, u'limit': 15, u'remaining': 15}}, u'guide': {u'/guide': {u'reset': 1517643937, u'limit': 180, u'remaining': 180}}}}
print "rate limit %s"%(api.rate_limit_status()['resources']['lists']['/lists/members'])

for record in records:
	for slug in record['match']:
		handle = slug.encode('utf-8')
		usr = api.get_user(screen_name='@'+handle)
		if handle not in prev_list:
			print '%s [ADD]'%(handle)
			api.add_list_member(screen_name='@'+handle, list_id=x_list.id)
		else:
			print "@%s [SKIP]"%(handle)
print '\nend *'
